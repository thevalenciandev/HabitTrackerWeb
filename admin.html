<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Habit tracker administration</title>
    <script type="text/javascript" src="users.js"></script>
    <script type="text/javascript" src="habits.js"></script>
    <script type="text/javascript" src="html-utils.js"></script>
  </head>
      <h1>Habit tracker (administration)</h1>
      
      <h2>Users</h2>
      <div id="list-user"></div>
      <div id="outcomeAction-user"></div>

      <h2>Habits</h2>
      <div id="list-habit"></div>
      <div id="outcomeAction-habit"></div>
      
      <h2>Add new users</h2>
      <form action="javascript:tryAddUser()">
        <label for="luser">User name:</label>
        <input type="text" id="luser">
        <input type="submit" value="Add">
      </form>
      <div id="outcomeAdd-user"></div>

      <h2>Add new habits</h2>
      <form action="javascript:tryAddHabit()">
        <label for="lhabit">Habit:</label>
        <input type="text" id="lhabit">
        <input type="submit" value="Add">
      </form>
      <div id="outcomeAdd-habit"></div>
      
      <a href="index.html">Go back</a>

      <script>
        // This function relies on a naming convention to work:
        // html lists must be named list-elmType, where elmType can be eg. user, habit, etc
        // Also the messages generated by this function rely on divs named outcomeAction-elmType
        function populateList(elmType, getListElmFunction, addElmFunction, removeElmFunction) {
          const listDiv = document.getElementById("list-" + elmType)
          const list = getListElmFunction()
          if (list.length == 0) {
            listDiv.innerText = "None."
            return
          }
          // 1. First clear the div 
          while (listDiv.firstChild) {
            listDiv.firstChild.remove()
          }
          // 2. Populate current list on div
          list.forEach(e => 
            listDiv.appendChild(createListElement(e, elmType, getListElmFunction, addElmFunction, removeElmFunction))
          )
        }

        function tryAddUser() {
          const newUser = document.getElementById("luser").value
          if (getExistingUsers().includes(newUser)) {
            alert(`${newUser} already exists`)
            return
          }
          addUser(newUser)
          displayOutcome("outcomeAdd-user", "Sucessfully added! 🎉")
          populateList("user", () => getExistingUsers(), u => addUser(u), u => removeUser(u))
        }

        function tryAddHabit() {
          const newHabit = document.getElementById("lhabit").value
          if (getExistingHabits().includes(newHabit)) {
            alert(`${newHabit} already exists`)
            return
          }
          addHabit(newHabit)
          displayOutcome("outcomeAdd-habit", "Sucessfully added! 🎉")
          populateList("habit", () => getExistingHabits(), h => addHabit(h), h => removeHabit(h))
        }

        // Upon loading page, do the following:
        populateList("user", () => getExistingUsers(), u => addUser(u), u => removeUser(u))
        populateList("habit", () => getExistingHabits(), h => addHabit(h), h => removeHabit(h))
      </script>
  </body>
</html>